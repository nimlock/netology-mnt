# Домашнее задание к занятию "10.06. Инцидент-менеджмент"

## Модуль 10. Системы мониторинга

### Студент: Иван Жиляев

## Задание 1

>Составьте постмотрем, на основе реального сбоя системы Github в 2018 году.
>
>Информация о сбое доступна [в виде краткой выжимки на русском языке](https://habr.com/ru/post/427301/) , а
>также [развёрнуто на английском языке](https://github.blog/2018-10-30-oct21-post-incident-analysis/).

Постмортем будет выглядеть так:

- Краткое описание инцидента (краткая выжимка о инциденте): 21 октября 2018 в 22:52 UTC в результате потери связи между `US East Coast network hub` и `primary US East Coast data center` на 43 секунды часть сервисов стала недоступной на 24 часа.

- Предшествующие события (что произошло перед инцидентом): выполнялись плановые технические работы по замене оптического оборудования.

- Причина инцидента (из-за чего возник инцидент): из-за потери сетевой связности кластеры БД в ЦОД-ах на западном и восточном побережьях оказались рассинхронизированы (содержали разные записи).

- Воздействие (на что повлиял инцидент): для возможности восстановления связности кластеров БД в ЦОД-ах были ограничен функционал сайта; также из-за повышенной нагрузки от процесса восстановления БД было заметно снижено быстродействие доступных функций сайта.

- Обнаружение (когда и как инцидент был обнаружен): 21 октября 2018 в 23:02 UTC инженеры мониторинга обнаружили множественные сбои в топологиях репликации кластеров БД. 

- Реакция (кто ответил на инцидент, кто был привлечен, какие каналы коммуникации были задействованы): 21 октября 2018 в 23:09 UTC после проведения диагностики инженеры мониторинга перевели статус обслуживания сайта на уровень Жёлтый, что автоматически привлекло к решению Координатора инцидентов. В 23:13 Координатор сменил статус обслуживания на Красный. К решению были привлечены инженеры из команды по работе с БД.

- Восстановление (описание действий по устранению инцидента и поведение системы): было решено восстановить кластеры БД из последнего бэкапа, восстановить связность кластеров БД, актуализировать read-реплики и применить записи из журнала транзакций отсутствующие в БД после восстановления.

- Таймлайн (последовательное описание ключевых событий инцидента с указанием времени):

    - 21 окт 22:52: произошел сетевой сбой и нарушение целостности БД
    - 21 окт 22:54: внутренние системы мониторинга сообщают об ошибках
    - 21 окт 23:09: дежурный инженер после диагностики событий установил уровень сервиса в Жёлтый
    - 21 окт 23:13: Координатор инцидентов установил уровень сервиса в Красный
    - 22 окт 00:41: запущено восстановление из бэкапов
    - 22 окт 11:12: восстановление завершено, primary всех БД расположены в ЦОД на восточном побережье; идёт синхронизация реплик
    - 22 окт 16:24: синхронизация реплик завершена, восстановление целевой топологии; идёт восстановление накопленных пользовательских данных + исполнение накопленных необслуженных действий по webhook-ам и сборкам Pages
    - 22 окт 23:03: восстановление работы сервиса завершено, смена статуса на Зелёный

- Последующие действия (что нужно предпринять, чтобы инцидент не повторялся): 

    - было решено настроить Оркестратор так, чтобы он не выносил primary-узел за пределы региона; так задержки в работе системы будут на приемлемом уровне
    - также решено ускорить переход на новую топологию active/active/active, увеличивающую отказоустойчивость системы

## Задача повышенной сложности

>Прослушайте [симуляцию аудиозаписи о инциденте](https://youtu.be/vw6I5DYWkNA?t=1), предоставленную 
>разработчиками инструмента для автоматизации инцидент-менеджмента PagerDuty.
>
>На основании этой аудиозаписи попробуйте составить сообщения для пользователей о данном инциденте.
>
>Должно быть 3 сообщения о:
>- начале инцидента
>- продолжающихся работах
>- окончании инцидента и возвращении к штатной работе

_Из формулировки задания не ясно что именно нужно сделать. Опишу работу с пользователями в данном примере инцидента._  

В ходе инцидента Координатор по связям с общественностью подготовил и опубликовал два сообщения в официальные каналы связи (Status web-page, Twitter) продукта. Предполагаю что всё взаимодействие проходило следующим образом:

- сообщение о начале инцидента ([6:38](https://youtu.be/vw6I5DYWkNA?t=398)): первичное оповещение проводится автоматически при определённых статусах инцидента. В примере инциденту был присвоен статус SEV-1. О подробностях информирования клиентов информации нет.
- сообщение о продолжающихся работах ([9:28](https://youtu.be/vw6I5DYWkNA?t=568)): "Зафиксирована проблема с отображением логов инцидентов в web-приложении. Мы работаем над этим."
- сообщение об окончании инцидента и возвращении к штатной работе ([23:35](https://youtu.be/vw6I5DYWkNA?t=1415)): "Мы решили проблему и контролируем ситуацию. Возникшие ошибки в работе программы будут устранены в течение нескольких минут."
